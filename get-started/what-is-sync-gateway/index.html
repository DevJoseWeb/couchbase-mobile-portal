<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head><title>What is Sync Gateway? | Couchbase Mobile - Developers</title><link rel="stylesheet" type="text/css" href="../../styles/style.css"></link><style class="language-stripe" id="language-stripe-objective-c" type="text/css">*.stripe-display.objective-c{display:inline;}*.stripe-active.objective-c{background:rgba(0, 0, 0, 0.05);}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-swift" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:inline;}*.stripe-active.swift{background:rgba(0, 0, 0, 0.05);}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-java" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:inline;}*.stripe-active.java{background:rgba(0, 0, 0, 0.05);}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-android" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:inline;}*.stripe-active.android{background:rgba(0, 0, 0, 0.05);}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-c" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:inline;}*.stripe-active.c{background:rgba(0, 0, 0, 0.05);}</style><script type="text/javascript">var languages = ["objective-c","swift","java","android","c"];
                    
	                var cookies = document.cookie.split(';');
				    for(var i=0; i<cookies.length; i++) {
				        var cookie = cookies[i].trim();
				        
				        if (cookie.indexOf("language=")==0) {
				            var selectedLanguage = cookie.substring(9, cookie.length);
				            if (selectedLanguage.length > 0) {
				                document.write("<style class='language-stripe' type='text/css'>");
				                for (var j=0; j<languages.length; j++) {
				                    var language = languages[j];
				                    document.write("*.stripe-display." + language + "{display:" + (language == selectedLanguage ? "inline" : "none") + ";}");
                                    document.write("*.stripe-active." + language + "{background:" + (language == selectedLanguage ? "rgba(0, 0, 0, 0.05)" : "transparent") + ";}");
				                }
				                document.write("</style>");
				            }
				            break;
				        }
				    }
				    
			    </script><script type="text/javascript">
                var rootPath = "../../";</script><script src="../../scripts/core.js"></script><script src="../../scripts/search-core.js"></script><script src="../../scripts/search.js"></script><script src="../../scripts/search-index.js"></script><noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
        </noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-MVPNN2');
        </script><script type="text/javascript">
            document.write(unescape("%3Cscript src='//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
        </script><script>Munchkin.init('302-GJY-034');</script></head><body onload="init()"><div class="page-header"><table class="navigator-bar"><tr><td><a class="dark logo" href="../../index.html"><div>Couchbase Mobile</div><div>Developers</div></a></td><td><a class="dark active" href="../../get-started/couchbase-mobile-overview/index.html">Get Started</a></td><td><a class="dark" href="../../develop/training/build-first-ios-app/index.html">Develop</a></td><td><a class="dark" href="https://forums.couchbase.com/mobile">Forums</a></td><td width="100%"></td><td><input class="search" type="text" onkeyup="search_onkeyup(this)" onchange="search_onchange(this)" onfocus="search_onfocus(this)" onblur="search_onblur(this)"></input></td></tr></table><div class="search-results-wrapper"><div class="search-results-floater"><div id="search-results" class="hidden"></div></div></div></div><div class="header-spacer"></div><div class="page-wrapper"><nav><ul class="nav-list"><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header" style="background: transparent"><a href="../../get-started/couchbase-mobile-overview/index.html">Couchbase Mobile Overview</a></div></li><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header" style="background: transparent"><a href="../../get-started/couchbase-lite-overview/index.html">Couchbase Lite Overview</a></div></li><li class="nav-section expanded"><div onclick="toggleExpanded(this.parentNode)" class="header active" style="background: transparent"><a href="../../get-started/what-is-sync-gateway/index.html">What is Sync Gateway?</a></div></li><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header" style="background: transparent"><a href="../../get-started/query-sorting/index.html">Query and Sorting</a></div></li><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../get-started/get-started-mobile/index.html">5 Minutes to Awesome</a></div><ul><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../get-started/get-started-mobile/ios/index.html">iOS</a></div><ul><li class="nav-item"><a href="../../get-started/get-started-mobile/ios/before-you-begin/index.html">はじめに</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/ios/building-todo-lite/index.html">Todo Liteを実際に作ってみる</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/ios/create-new-project/index.html">Creating a new project</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../get-started/get-started-mobile/android/index.html">Android</a></div><ul><li class="nav-item"><a href="../../get-started/get-started-mobile/android/before-you-begin/index.html">はじめに</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/android/building-todo-lite/index.html">Todo Liteを実際に作ってみる</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/android/get-started-studio/index.html">Create a new project with Android Studio</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../get-started/get-started-mobile/net-mobile/index.html">.NET</a></div><ul><li class="nav-item"><a href="../../get-started/get-started-mobile/net-mobile/before-you-begin/index.html">はじめに</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/net-mobile/building-todolite-net/index.html">Todo Liteを作ってみる (Coming soon!)</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/net-mobile/create-new-project/index.html">Creating a new project</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../get-started/get-started-mobile/phonegap/index.html">PhoneGap</a></div><ul><li class="nav-item"><a href="../../get-started/get-started-mobile/phonegap/prepare/index.html">Prepare your workstation</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/phonegap/build-and-run/index.html">ビルドと実行</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/phonegap/troubleshooting/index.html">Troubleshooting</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../get-started/get-started-mobile/cloud-sync-function/index.html">Sync｜組込みのNoSQLデータベースとサーバを簡単に同期</a></div><ul><li class="nav-item"><a href="../../get-started/get-started-mobile/cloud-sync-function/local-first-data/index.html">ローカルファーストのデータ</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/cloud-sync-function/cloud-data/index.html">クラウド上のデータ</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/cloud-sync-function/sync-function-example/index.html">Sync(同期)機能について</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../get-started/get-started-mobile/todo-lite/index.html">ToDo Liteアプリのコード紹介</a></div><ul><li class="nav-item"><a href="../../get-started/get-started-mobile/todo-lite/application-launch/index.html">アプリケーションの開始</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/todo-lite/create-and-update-tasks/index.html">タスクドキュメントの新規作成と更新</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/todo-lite/attach-a-photo/index.html">ファイルの添付</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/todo-lite/login-and-sync/index.html">ログインとSync(同期)</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/todo-lite/sharing-lists/index.html">リストの共有</a></li><li class="nav-item"><a href="../../get-started/get-started-mobile/todo-lite/whats-missing/index.html">他に必要な機能は？</a></li></ul></li></ul></li></ul></nav><article class="content-wrapper"><h1>What is Sync Gateway?</h1><p>Sync Gateway enables each Couchbase Lite database to replicate changes to your app's data in both directions. Couchbase Lite pushes up changes in your app's on-device data, and Sync Gateway stores that data a "bucket" backed by our highly scalable Couchbase Server technology.</p><p>Sync Gateway runs at the boundary between your private cloud and the public cloud.  It handles the same application concerns that you would have in any web-based application such as user authentication, authorization, and logging. Sync Gateway also provides you with a way to determine what records are relevant for each user, which we call "data orchestration."</p><h2 id="couchbase-sync">Synchronization</h2><hr></hr>
                <h3 id="sync">Couchbase Lite Replicators</h3><p>All Couchbase Lite platforms can set up push and/or pull replication sessions to Sync Gateway. It takes very little code to accomplish this. Here is all the code that you would typically need to enable full bi-directional, authenticated, realtime sync between Couchbase Lite and Sync Gateway :</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c">C#</a></div><span class="stripe-display objective-c"><pre><code>NSURL *url = [[NSURL alloc] initWithString:@"http://localhost:4984/my-app/"];
CBLReplication *push = [database createPushReplication:url];
CBLReplication *pull = [database createPullReplication:url];
push.continuous = pull.continuous = YES;
id&lt;CBLAuthenticator&gt; *auth = [CBLAuthenticator basicAuthenticatorWithName:@"president" password:@"password!"];
[push setAuthenticator:auth];
[pull setAuthenticator:auth];
[push start];
[pull start];
</code></pre></span><span class="stripe-display swift"><pre><code>let url = NSURL(string: "http://localhost:4984/my-app/")
let push = database.createPushReplication(url)
let pull = database.createPullReplication(url)
push.continuous = true
pull.continuous = true
var auth: CBLAuthenticatorProtocol?
auth = CBLAuthenticator.basicAuthenticatorWithName(username, password: password)
push.authenticator = auth
pull.authenticator = auth
push.start();
pull.start();
</code></pre></span><span class="stripe-display java"><pre><code>URL url = new URL("http://localhost:4984/my-app/");
Replication push = database.createPushReplication(url);
Replication pull = database.createPullReplication(url);
pull.setContinuous(true);
push.setContinuous(true);
Authenticator auth = AuthenticatorFactory.createBasicAuthenticator("president", "password!");
push.setAuthenticator(auth);
pull.setAuthenticator(auth);
push.start();
pull.start();
</code></pre></span><span class="stripe-display android"><pre><code>URL url = new URL("http://localhost:4984/my-app/");
Replication push = database.createPushReplication(url);
Replication pull = database.createPullReplication(url);
pull.setContinuous(true);
push.setContinuous(true);
Authenticator auth = AuthenticatorFactory.createBasicAuthenticator("president", "password!");
push.setAuthenticator(auth);
pull.setAuthenticator(auth);
push.start();
pull.start();
</code></pre></span><span class="stripe-display c"><pre><code>Uri url = new Hri("http://localhost:4984/my-app/");
Replication push = database.CreatePushReplication(url);
Replication pull = database.CreatePullReplication(url);
pull.Continuous = true;
push.Continuous = true;
Authenticator auth = AuthenticatorFactory.CreateBasicAuthenticator("president", "password!");
push.Authenticator = auth;
pull.Authenticator = auth;
push.Start();
pull.Start();
</code></pre></span><p>There are a number of additional replication options that you can use in your application to handle complex scenarios, but this example covers the vast majority of use cases.</p><p>You can scale out Sync Gateway just like you would any web application: by adding more nodes behind a load balancer, such as nginx.</p>
                <h3 id="sync-function">Sync Function</h3><p>The <strong>sync function</strong> is the core API you interact with on
                        Sync Gateway. For simple applications it might be the only server-side code you
                        need to write. For more complex applications it is still a primary touchpoint for
                        managing data routing and access control.</p><p>The sync function is a JavaScript function whose source code is stored
                        in the Sync Gateway's database configuration file. Every time a new document,
                        revision or deletion is added to a database, the sync function is called and given
                        a chance to examine the document. It can do the following things:</p><ul><li><strong>Validate the document:</strong> If the document has invalid
                            contents, the sync function can throw an exception to reject it. The document
                            won't be added to the database, and Sync Gateway will return an error
                            response</li><li><strong>Authorize the change:</strong> The sync function can call
                            <code>requireUser()</code> or <code>requireRole()</code> to specify what
                            user(s) are allowed to modify the document. If the user making the change isn't
                            in that list, an exception is thrown and the update is rejected with an
                            error. Similarly, <code>requireChannels()</code> requires that the user making
                            the change have access to any of the listed channels.</li><li><strong>Assign the document to channels:</strong> Based on the
                            contents of the document, the sync function can call <code>channel()</code> to
                            add the document to one or more channels. This makes it accessible to users who
                            have access to those channels, and will cause the document to be synced down to
                            users that subscribe to those channels.</li><li><strong>Grant users access to channels:</strong> Calling
                            <code>access(user, channel)</code> grants a user access to a channel. This
                            allows documents to act as membership lists or access-control lists.</li></ul><div class="note caution"><span class="tag">Caution:</span><strong>The sync function is crucial to the security of your
                        application.</strong> It's in charge of data validation, and of authorizing both
                        read and write access to documents. The API is high-level and lets you do some
                        powerful things very simply, but you do need to remain vigilant and review the
                        function carefully to make sure that it detects threats and prevents all illegal
                        access. The sync function should be a focus of any security review of your
                        application.</div>
            <h2 id="example">Example</h2><hr></hr>
                <p>Here's an example of a complete, useful sync function that
                properly validates and authorizes both new and updated documents. The
                requirements are:</p>
                <ul><li>Only users with the role <code>editor</code> may create or
                    delete documents.</li><li>Every document has an immutable <code>creator</code>
                    property containing the name of the user who created it.</li><li>Only users named in the document's (required, non-empty)
                    <code>writers</code> property may make changes to a document, including
                    deleting it.</li><li>Every document must also have a <code>title</code> and a
                    <code>channels</code> property.</li></ul>
                <pre><code>function (doc, oldDoc) {
    if (doc._deleted) {
        // Only editors with write access can delete documents:
        requireRole("role:editor");
        requireUser(oldDoc.writers);
        // Skip other validation because a deletion has no other properties:
        return;
    }
    // Required properties:
    if (!doc.title || !doc.creator || !doc.channels || !doc.writers) {
        throw(forbidden: "Missing required properties");
    } else if (doc.writers.length == 0) {
        throw(forbidden: "No writers");
    }
    if (oldDoc == null) {
        // Only editors can create documents:
        requireRole("role:editor");
        // The 'creator' property must match the user creating the document:
        requireUser(doc.creator)
    } else {
        // Only users in the existing doc's writers list can change a document:
        requireUser(oldDoc.writers);
        // The "creator" property is immutable:
        if (doc.creator != oldDoc.creator) {
            throw(forbidden: "Can't change creator");
        }
    }
    // Finally, assign the document to the channels in the list:
    channel(doc.channels);
}
</code></pre>
            <h2 id="summary">Next Steps</h2><hr></hr>
                <p>
                    To learn more, see the <a href="../../develop/guides/sync-gateway/index.html">Sync Gateway Guide</a> in our documentation. There are also sample applications which show these Sync Gateway concepts in both the <a href="https://github.com/couchbaselabs/Grocery-Sync-iOS">GrocerySync iOS</a> and <a href="https://github.com/couchbaselabs/GrocerySync-Android">GrocerySync Android</a> sample applications.
                </p>
            </article></div><div class="page-footer"><span>Copyright © 2015 Couchbase Inc.  All rights reserved.</span><a href="http://www.couchbase.com/terms-of-service">Terms of Use</a><a href="http://www.couchbase.com/privacy">Privacy Policy</a></div></body></html>