<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head><title>リストの共有 | Couchbase - Mobile Developers</title><link rel="stylesheet" type="text/css" href="../../../../styles/style.css"></link><style class="language-stripe" id="language-stripe-objective-c" type="text/css">*.stripe-display.objective-c{display:inline;}*.stripe-active.objective-c{background:rgba(0, 0, 0, 0.05);}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-swift" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:inline;}*.stripe-active.swift{background:rgba(0, 0, 0, 0.05);}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-java" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:inline;}*.stripe-active.java{background:rgba(0, 0, 0, 0.05);}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-android" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:inline;}*.stripe-active.android{background:rgba(0, 0, 0, 0.05);}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-c" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:inline;}*.stripe-active.c{background:rgba(0, 0, 0, 0.05);}</style><script type="text/javascript">var languages = ["objective-c","swift","java","android","c"];
                    
	                var cookies = document.cookie.split(';');
				    for(var i=0; i<cookies.length; i++) {
				        var cookie = cookies[i].trim();
				        
				        if (cookie.indexOf("language=")==0) {
				            var selectedLanguage = cookie.substring(9, cookie.length);
				            if (selectedLanguage.length > 0) {
				                document.write("<style class='language-stripe' type='text/css'>");
				                for (var j=0; j<languages.length; j++) {
				                    var language = languages[j];
				                    document.write("*.stripe-display." + language + "{display:" + (language == selectedLanguage ? "inline" : "none") + ";}");
                                    document.write("*.stripe-active." + language + "{background:" + (language == selectedLanguage ? "rgba(0, 0, 0, 0.05)" : "transparent") + ";}");
				                }
				                document.write("</style>");
				            }
				            break;
				        }
				    }
				    
			    </script><script type="text/javascript">
                var rootPath = "../../../../";</script><script src="../../../../scripts/core.js"></script><script src="../../../../scripts/search-core.js"></script><script src="../../../../scripts/search.js"></script><script src="../../../../scripts/search-index.js"></script><script type="text/javascript">
	        
	        var _gaq = _gaq || [];
	        _gaq.push(['_setAccount', 'UA-7763794-1']);
	        _gaq.push(['_trackPageview']);

	        (function() {
	            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	        })();
	        
	    </script></head><body onload="init()"><div class="page-header"><table class="navigator-bar"><tr><td><a class="dark logo" href="../../../../index.html"><div>Couchbase</div><div>Mobile Developers</div></a></td><td><a class="dark active" href="../../../../get-started/get-started-mobile/index.html">Get Started</a></td><td><a class="dark" href="../../../../develop/training/build-first-ios-app/index.html">Develop</a></td><td><a class="dark" href="https://forums.couchbase.com/mobile">Forums</a></td><td width="100%"></td><td><input class="search" type="text" onkeyup="search_onkeyup(this)" onchange="search_onchange(this)" onfocus="search_onfocus(this)" onblur="search_onblur(this)"></input></td></tr></table><div class="search-results-wrapper"><div class="search-results-floater"><div id="search-results" class="hidden"></div></div></div></div><div class="header-spacer"></div><div class="page-wrapper"><nav><ul class="nav-list"><li class="nav-section expanded"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../get-started/get-started-mobile/index.html">5 Minutes to Awesome</a></div><ul><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../get-started/get-started-mobile/ios/index.html">iOS</a></div><ul><li class="nav-item"><a href="../../../../get-started/get-started-mobile/ios/before-you-begin/index.html">はじめに</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/ios/building-todo-lite/index.html">Todo Liteを実際に作ってみる</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/ios/create-new-project/index.html">Creating a new project</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../get-started/get-started-mobile/android/index.html">Android</a></div><ul><li class="nav-item"><a href="../../../../get-started/get-started-mobile/android/before-you-begin/index.html">はじめに</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/android/building-todo-lite/index.html">Todo Liteを実際に作ってみる</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/android/get-started-eclipse/index.html">Create a new project with Eclipse</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/android/get-started-studio/index.html">Create a new project with Android Studio</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../get-started/get-started-mobile/net-mobile/index.html">.NET</a></div><ul><li class="nav-item"><a href="../../../../get-started/get-started-mobile/net-mobile/before-you-begin/index.html">はじめに</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/net-mobile/building-todolite-net/index.html">Todo Liteを作ってみる (Coming soon!)</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/net-mobile/create-new-project/index.html">Creating a new project</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../get-started/get-started-mobile/phonegap/index.html">PhoneGap</a></div><ul><li class="nav-item"><a href="../../../../get-started/get-started-mobile/phonegap/prepare/index.html">Prepare your workstation</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/phonegap/build-and-run/index.html">ビルドと実行</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/phonegap/troubleshooting/index.html">Troubleshooting</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../get-started/get-started-mobile/cloud-sync-function/index.html">Sync｜組込みのNoSQLデータベースとサーバを簡単に同期</a></div><ul><li class="nav-item"><a href="../../../../get-started/get-started-mobile/cloud-sync-function/local-first-data/index.html">ローカルファーストのデータ</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/cloud-sync-function/cloud-data/index.html">クラウド上のデータ</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/cloud-sync-function/sync-function-example/index.html">Sync(同期)機能について</a></li></ul></li><li class="nav-subsection expanded"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../get-started/get-started-mobile/todo-lite/index.html">ToDo Liteアプリのコード紹介</a></div><ul><li class="nav-item"><a href="../../../../get-started/get-started-mobile/todo-lite/application-launch/index.html">アプリケーションの開始</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/todo-lite/create-and-update-tasks/index.html">タスクドキュメントの新規作成と更新</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/todo-lite/attach-a-photo/index.html">ファイルの添付</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/todo-lite/login-and-sync/index.html">ログインとSync(同期)</a></li><li class="nav-item active"><a href="../../../../get-started/get-started-mobile/todo-lite/sharing-lists/index.html">リストの共有</a></li><li class="nav-item"><a href="../../../../get-started/get-started-mobile/todo-lite/whats-missing/index.html">他に必要な機能は？</a></li></ul></li></ul></li></ul></nav><article class="content-wrapper"><h1>リストの共有</h1><div class="toc"><h2>In this document</h2><ul class="plain"><li><a href="#view-profiles">プロファイルのビュー</a></li><li><a href="#add-members">リストにメンバーを登録する</a></li></ul></div><p>ユーザがクラウドとSync(同期)したら、リストを共有できるユーザのリストと同期が出来るようになります。
　　　　　　　　　　　　　</p><h2 id="view-profiles">プロファイルのビュー</h2><hr></hr>
                    <p>
                         このリストはビューのクエリをリストの名前と結びつけてShare UIを効率的にするものです。仮にあなたがこのビューを使って、あるユーザがログインした場合、このユーザの名前がポップアップするのを見ることができます。
                    </p>
                    <div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift disabled">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>- (void)configureView
{
    // Do any additional setup after loading the view.
    _dataSource.query = [Profile queryProfilesInDatabase: database].asLiveQuery;
    _dataSource.labelProperty = @"name";    // Document property to display in the cell label}
}
// Customizes the appearance of table view cells.
- (void)couchTableSource:(CBLUITableSource*)source
             willUseCell:(UITableViewCell*)cell
                  forRow:(CBLQueryRow*)row
{
    
    // Configure the cell contents.
    // (cell.textLabel.text is already set, thanks to setting up labelProperty above.)
    NSString* personId = row.document.documentID;
//    if the person's id is in the list of members, or is the owner we are happy.
    bool member = NO;
    if ([myDocId isEqualToString:personId]) {
        member = YES;
    } else {
        NSMutableSet *intersection = [NSMutableSet setWithArray:_list.members];
        [intersection intersectSet:[NSSet setWithObject:personId]];
        
        if ([intersection count] &gt; 0) {
            member = YES;
        }
    }
    if (member) {
        cell.accessoryType = UITableViewCellAccessoryCheckmark;
    } else {
        cell.accessoryType = UITableViewCellAccessoryNone;
    }
}
                              
</code></pre></span><span class="stripe-display swift"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display java"><pre><code>final Document user = (Document) getItem(position);
final CheckBox checkBox = (CheckBox) convertView.findViewById(R.id.checked);
boolean checked = isMemberOfTheCurrentList(user);
checkBox.setChecked(checked);
checkBox.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View view) {
        try {
            if (checkBox.isChecked()) {
                List.addMemberToList(mCurrentList, user);
            } else {
                List.removeMemberFromList(mCurrentList, user);
            }
        } catch (CouchbaseLiteException e) {
            Log.e(Application.TAG, "Cannot update a member to a list", e);
        }
    }
});
                  
</code></pre></span><span class="stripe-display android"><pre><code>final Document user = (Document) getItem(position);
final CheckBox checkBox = (CheckBox) convertView.findViewById(R.id.checked);
boolean checked = isMemberOfTheCurrentList(user);
checkBox.setChecked(checked);
checkBox.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View view) {
        try {
            if (checkBox.isChecked()) {
                List.addMemberToList(mCurrentList, user);
            } else {
                List.removeMemberFromList(mCurrentList, user);
            }
        } catch (CouchbaseLiteException e) {
            Log.e(Application.TAG, "Cannot update a member to a list", e);
        }
    }
});
                  
</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>
               <h2 id="add-members">リストにメンバーを登録する</h2><hr></hr>
                              <p>
                                   リストからあるユーザを選択すると、リストのメンバーとして追加(または削除)されます。
                              </p>
                              <div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift disabled">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    CBLQueryRow *row = [self.dataSource rowAtIndex:indexPath.row];
    NSString *toggleMemberId = row.document.documentID;
    NSArray *ms = _list.members;
    if (!ms) ms = @[];
    NSLog(@"toggle %@ members %@", toggleMemberId, [ms componentsJoinedByString:@" "]);
    NSUInteger x = [ms indexOfObject:toggleMemberId];
    NSLog(@"index member %d",x);
    
    if (x == NSNotFound) {
//        add to array
        _list.members = [ms arrayByAddingObject:toggleMemberId];
    } else {
//        remove from array
        _list.members = [ms filteredArrayUsingPredicate:[NSPredicate predicateWithFormat:@"SELF != %@" argumentArray:@[toggleMemberId]]];
    }
    NSLog(@"!!!!! %@", [_list.members componentsJoinedByString:@" "]);
    
    // Save changes:
    NSError* error;
    if (![_list save: &amp;error]) {
    }
    [self configureView];
}
                              
</code></pre></span><span class="stripe-display swift"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display java"><pre><code>public static void addMemberToList(Document list, Document user)
        throws CouchbaseLiteException {
    Map&lt;String, Object&gt; newProperties = new HashMap&lt;String, Object&gt;();
    newProperties.putAll(list.getProperties());
    java.util.List&lt;String&gt; members = (java.util.List&lt;String&gt;) newProperties.get("members");
    if (members == null) members = new ArrayList&lt;String&gt;();
    members.add(user.getId());
    newProperties.put("members", members);
    try {
        list.putProperties(newProperties);
    } catch (CouchbaseLiteException e) {
        com.couchbase.lite.util.Log.e(Application.TAG, "Cannot add member to the list", e);
    }
}
public static void removeMemberFromList(Document list, Document user)
        throws CouchbaseLiteException {
    Map&lt;String, Object&gt; newProperties = new HashMap&lt;String, Object&gt;();
    newProperties.putAll(list.getProperties());
    java.util.List&lt;String&gt; members = (java.util.List&lt;String&gt;) newProperties.get("members");
    if (members != null) members.remove(user.getId());
    newProperties.put("members", members);
    list.putProperties(newProperties);
}
                          
</code></pre></span><span class="stripe-display android"><pre><code>public static void addMemberToList(Document list, Document user)
        throws CouchbaseLiteException {
    Map&lt;String, Object&gt; newProperties = new HashMap&lt;String, Object&gt;();
    newProperties.putAll(list.getProperties());
    java.util.List&lt;String&gt; members = (java.util.List&lt;String&gt;) newProperties.get("members");
    if (members == null) members = new ArrayList&lt;String&gt;();
    members.add(user.getId());
    newProperties.put("members", members);
    try {
        list.putProperties(newProperties);
    } catch (CouchbaseLiteException e) {
        com.couchbase.lite.util.Log.e(Application.TAG, "Cannot add member to the list", e);
    }
}
public static void removeMemberFromList(Document list, Document user)
        throws CouchbaseLiteException {
    Map&lt;String, Object&gt; newProperties = new HashMap&lt;String, Object&gt;();
    newProperties.putAll(list.getProperties());
    java.util.List&lt;String&gt; members = (java.util.List&lt;String&gt;) newProperties.get("members");
    if (members != null) members.remove(user.getId());
    newProperties.put("members", members);
    list.putProperties(newProperties);
}
                          
</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>
                             <pre><code>function toggleShare(doc, user, cb) {
    doc.members = doc.members || [];
    var i = doc.members.indexOf(user)
    if (i === -1) {
        doc.members.push(user)
    } else {
        doc.members.splice(i,1)
    }
    log("members", doc.members)
    config.db.post(doc, cb)
}
                                 
</code></pre>
                         </article><div class="page-footer"><span>Copyright © 2014 Couchbase Inc.  All rights reserved.</span><a href="http://www.couchbase.com/terms-of-service">Terms of Use</a><a href="http://www.couchbase.com/privacy">Privacy Policy</a></div></div></body></html>