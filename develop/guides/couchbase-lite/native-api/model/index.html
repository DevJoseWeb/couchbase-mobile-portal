<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head><title>Model (iOS only) | Couchbase - Mobile Developers</title><link rel="stylesheet" type="text/css" href="../../../../../styles/style.css"></link><style class="language-stripe" id="language-stripe-objective-c" type="text/css">*.stripe-display.objective-c{display:inline;}*.stripe-active.objective-c{background:rgba(0, 0, 0, 0.05);}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-swift" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:inline;}*.stripe-active.swift{background:rgba(0, 0, 0, 0.05);}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-java" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:inline;}*.stripe-active.java{background:rgba(0, 0, 0, 0.05);}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-android" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:inline;}*.stripe-active.android{background:rgba(0, 0, 0, 0.05);}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-c" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:inline;}*.stripe-active.c{background:rgba(0, 0, 0, 0.05);}</style><script type="text/javascript">var languages = ["objective-c","swift","java","android","c"];
                    
	                var cookies = document.cookie.split(';');
				    for(var i=0; i<cookies.length; i++) {
				        var cookie = cookies[i].trim();
				        
				        if (cookie.indexOf("language=")==0) {
				            var selectedLanguage = cookie.substring(9, cookie.length);
				            if (selectedLanguage.length > 0) {
				                document.write("<style class='language-stripe' type='text/css'>");
				                for (var j=0; j<languages.length; j++) {
				                    var language = languages[j];
				                    document.write("*.stripe-display." + language + "{display:" + (language == selectedLanguage ? "inline" : "none") + ";}");
                                    document.write("*.stripe-active." + language + "{background:" + (language == selectedLanguage ? "rgba(0, 0, 0, 0.05)" : "transparent") + ";}");
				                }
				                document.write("</style>");
				            }
				            break;
				        }
				    }
				    
			    </script><script type="text/javascript">
                var rootPath = "../../../../../";</script><script src="../../../../../scripts/core.js"></script><script src="../../../../../scripts/search-core.js"></script><script src="../../../../../scripts/search.js"></script><script src="../../../../../scripts/search-index.js"></script><script type="text/javascript">
	        
	        var _gaq = _gaq || [];
	        _gaq.push(['_setAccount', 'UA-7763794-1']);
	        _gaq.push(['_trackPageview']);
	        
	        (function() {
	            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	        })();
	        
	    </script></head><body onload="init()"><div class="page-header"><table class="navigator-bar"><tr><td><a class="dark logo" href="../../../../../index.html"><div>Couchbase</div><div>Mobile Developers</div></a></td><td><a class="dark" href="../../../../../get-started/get-started-mobile/index.html">Get Started</a></td><td><a class="dark active" href="../../../../../develop/training/build-first-ios-app/index.html">Develop</a></td><td><a class="dark" href="https://forums.couchbase.com/mobile">Forums</a></td><td width="100%"></td><td><input class="search" type="text" onkeyup="search_onkeyup(this)" onchange="search_onchange(this)" onfocus="search_onfocus(this)" onblur="search_onblur(this)"></input></td></tr></table><div class="search-results-wrapper"><div class="search-results-floater"><div id="search-results" class="hidden"></div></div></div><table class="navigator-bar secondary"><tr><td><a class="dark" href="../../../../../develop/training/build-first-ios-app/index.html">Training</a></td><td><a class="dark active" href="../../../../../develop/guides/modeling/index.html">Guides</a></td><td><a class="dark" href="../../../../../develop/references/couchbase-lite/index.html">API References</a></td><td><a class="dark" href="../../../../../develop/samples/samples/index.html">Samples</a></td><td><a class="dark" href="http://www.couchbase.com/nosql-databases/downloads#Couchbase_Mobile">Downloads</a></td><td width="100%"></td></tr></table></div><div class="header-spacer"></div><div class="page-wrapper"><nav><ul class="nav-list"><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/modeling/index.html">Data Modeling</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/modeling/basics/index.html">The Basics</a></li><li class="nav-item"><a href="../../../../../develop/guides/modeling/one-to-many/index.html">One-to-Many Relationships</a></li></ul></li><li class="nav-section expanded"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/couchbase-lite/index.html">Couchbase Lite</a></div><ul><li class="nav-subsection expanded"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/couchbase-lite/native-api/index.html">Native API</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/manager/index.html">Manager</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/database/index.html">Database</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/document/index.html">Document</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/revision/index.html">Revision</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/attachment/index.html">Attachment</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/view/index.html">View</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/query/index.html">Query</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/replication/index.html">Replication</a></li><li class="nav-item active"><a href="../../../../../develop/guides/couchbase-lite/native-api/model/index.html">Model (iOS only)</a></li></ul></li></ul></li><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/index.html">Sync Gateway</a></div><ul><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/index.html">Running the Sync Gateway</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/installing-sync-gateway/index.html">Installing Sync Gateway</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/connecting-sync-gateway-to-couchbase-server/index.html">Connecting Sync Gateway to Couchbase Server</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/starting-sync-gateway/index.html">Starting Sync Gateway</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/stopping-sync-gateway/index.html">Stopping Sync Gateway</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/index.html">Configuration and administration</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/command-line-tool/index.html">Configuration options</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/administering-the-rest-apis/index.html">Administering the REST APIs</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/authorizing-users/index.html">Authorizing Users</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/authenticating-users/index.html">Authenticating Users</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/channels/index.html">Data routing with "channels"</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/channels/intro/index.html">Introduction to channels</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/channels/developing/index.html">Developing channels</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/channels/troubleshooting/index.html">Troubleshooting channels</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/index.html">Sync Function API</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/intro/index.html">Introduction</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/validation/index.html">Validation and Authorization</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/routing/index.html">Routing</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/wcbs/index.html">Working with web apps</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/wcbs/bucket-shadowing/index.html">Pre-existing data and "bucket shadowing"</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/changes-worker/index.html">Connecting additional backend processes</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/changes-worker/pattern/index.html">Changes Worker Pattern</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/changes-worker/example-workflow/index.html">Example Document Workflow</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/changes-worker/push/index.html">Push Notification Code</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/deployment/index.html">Deployment considerations</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/deployment/during-development/index.html">During Development</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/deployment/in-production/index.html">In Production</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/deployment/troubleshooting/index.html">Troubleshooting and Fine-Tuning</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/nginx/index.html">Deploying Sync Gateway behind a reverse proxy</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/nginx/introduction-to-reverse-proxies/index.html">Introduction to reverse proxies</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/nginx/configuring-nginx-for-sync-gateway/index.html">Deploying and configuring nginx</a></li></ul></li></ul></li></ul></nav><article class="content-wrapper"><h1>Model (iOS only)</h1><div class="toc"><h2>In this document</h2><ul class="plain"><li><a href="#subclassing">Defining model classes</a><ul><li><a href="#properties">Types of properties and how they're stored</a></li><li><a href="#arrays">Array element types</a></li><li><a href="#raw">Raw access to document properties</a></li><li><a href="#attachments">Attachments</a></li></ul></li><li><a href="#instantiating">Instantiating model objects</a><ul><li><a href="#initializers">Custom initializer methods</a></li><li><a href="#factory">Dynamic instantiation using the model factory</a></li></ul></li><li><a href="#saving">Saving model objects</a><ul><li><a href="#customizing-save">Customizing saving</a></li></ul></li></ul></div><p>Most applications use the Model/View/Controller design pattern to separate user interface and user interaction from underlying data structures and logic. Of course, one of the responsibilities of the app's object model is persistence.</p><p>Couchbase Lite on iOS provides support for creating model objects that persist to Couchbase Lite documents, and can be queried using Couchbase Lite queries. (This functionality is similar to Core Data's NSManagedObject.) You subclass the abstract class CBLModel and add your own Objective-C properties, plus a very small amount of annotation that defines how those properties map to JSON in the document.</p><div class="note"><span class="tag">Note:</span>Model objects are currently only available in Objective-C. They may be added to the other implementations in the future, although the property-related features may be different in order to fit in with those platforms' idioms.</div><h3 id="features">What model objects give you</h3><dl><dt>Native property access</dt><dd>Access document properties as native Objective-C properties.</dd><dt>Extended type support</dt><dd>Transparent support for common types that don't have a JSON representation, like NSDate and NSData. You can even represent references to other model objects.</dd><dt>Mutable state</dt><dd>Properties can be <code>readwrite</code>, so they can be changed in memory, then later saved back to the document.</dd><dt>Key-Value Observing</dt><dd>You can observe the value of a property and get notified when it changes. On Mac OS X, you can also use bindings to connect properties to UI controls.</dd><dt>Dynamic typing</dt><dd>You can use the CBLModelFactory to associate each model class with a document type. You can create a hierarchy of model classes and have the appropriate subclass instantiated at runtime according to the document's type.</dd></dl><h2 id="subclassing">Defining model classes</h2><hr></hr>
                <p>To create your own model class, just make it inherit from CBLModel. You can create any number of model classes, and they can inherit from each other. Each model class will correspond to a different type of persistent entity in your application.</p>
                <p>You define persistent properties of your model classes simply by declaring Objective-C properties in its <code>@interface</code> block using the <code>@property</code> syntax. To mark a property as persistent, in the <code>@implementation</code> block you must declare it as being <code>@dynamic</code>, as shown in the next example.</p>
                <div class="note caution"><span class="tag">Caution:</span>If you forget to declare a persistent property as <code>@dynamic</code>, the compiler will automatically synthesize a regular instance variable with getter/setter methods, so your program will compile and will appear to work except that the property won't be persistently saved to the document. This can be hard to debug! You can have the compiler flag missing <code>@dynamic</code> declarations by enabling the "Implicit Synthesized Properties" warning in the Xcode target build settings, but if you do this you'll also need to explicitly use <code>@synthesize</code> declarations for all synthesized properties.</div>
                <p>Here's the declaration of a simple model class for a to-do list item:</p>
                <div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>@interface Note : CBLModel
@property (copy) NSString* text;
@property NSDate* created;
@property bool checked;    // bool not BOOL! See below for why
@end
</code></pre></span><span class="stripe-display swift"><pre><code>@objc(Note)
class Note: CBLModel {
    @NSManaged var message: NSString
    @NSManaged var created: NSDate
    @NSManaged var checked: Bool
}
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>
                <p>And here's the implementation of the class:</p>
                <pre><code>@implementation Note
@dynamic text, created, checked; // marks these as persistent
@end
</code></pre>
                <p>This is, literally, all the code you need to write for a minimal but fully functional model class!</p>
                <div class="note"><span class="tag">Note:</span>The name of the Objective-C property is exactly the same as the name of the JSON property in the document. If you're defining a model class for pre-existing documents, make sure you spell the property names the same way, including capitalization and underscores!</div>
                
            <h3 id="properties">Types of properties and how they're stored</h3><p>CBLModel supports a pretty broad range of data types for properties, but not everything goes, and some types require special handling. Types that can't be directly represented in JSON — like dates — will be converted to a string representation, but will be properly converted back to the property's native type when the model object is next read from the database.</p><dl><dt>Numeric types</dt><dd>All numeric types will be stored in JSON as numbers.</dd><dt>Booleans</dt><dd>Declare boolean properties as the C99 type <code>bool</code>, not the legacy Objective-C type <code>BOOL</code>. (Why not? The latter is really just a typedef for <code>char</code>, so at runtime it just looks like an 8-bit integer, which means it'll be stored in JSON as 0 or 1, not true or false.)</dd><dt>NSString</dt><dd>Maps to a JSON string, of course.</dd><dt>NSDate</dt><dd>JSON doesn't have a date type, so the date will be stored as a string in the semi-standard ISO-8601 format, and parsed from that format when read in.</dd><dt>NSData</dt><dd>JSON doesn't support binary data, so the data will be encoded as Base64 and stored as a string. (The size and CPU overhead of the conversion make this inefficient for large data. Consider using an attachment instead.)</dd><dt>Other CBLModel classes</dt><dd>You can create a one-to-one references to another model object by declaring a persistent property whose type is a CBLModel subclass. The value will be persisted as a JSON string containing the document ID of the model object.</dd><dt>NSArray</dt><dd>An NSArray is saved as a JSON array, with each element of the array converted to JSON according to the rules in this section. When reading a JSON array from a document, however, it can be ambiguous what type of object to use; there are annotations that can customize that. See below.</dd><dt>Any class implementing CBLJSONEncoding</dt><dd><code>CBLJSONEncoding</code> is an Objective-C protocol defined by Couchbase Lite. Any class of yours that implements this protocol can be used as the type of a persistent property; CBLModel will call the CBLJSONEncoding API to tell the object to convert itself to/from JSON.</dd></dl><div class="note"><span class="tag">Note:</span>If an object-valued property has a value of <code>nil</code>, its corresponding JSON property will be left out entirely when saving the document; it will <em>not</em> be written with a JSON <code>null</code> as a value. Similarly, any missing property in the JSON will be converted to a nil or 0 or false value in Objective-C.</div><div class="note"><span class="tag">Note:</span>If a JSON value read from a document has a type that's incompatible with the corresponding model property — like a string when the property type is <code>int</code> — the model property will be set to the appropriate empty value (<code>0</code>, <code>false</code>, or <code>nil</code>). If you need stricter type matching, you should add a validation function to the Database, to ensure that documents have the correct JSON property types.</div>
            
            <h3 id="arrays">Array element types</h3><p>The <code>NSArray</code> property type often needs special handling, to ensure that the items of JSON arrays are converted to the correct type of object. By default, the items are simply parsed as JSON; this breaks round-trip fidelity if you store NSDate or NSData or CBLModel objects -- they'll all be read back in as NSStrings. And if you store objects implementing CBLJSONEncoding, they'll be read back in as whatever JSON-compatible value the object encoded itself as.</p><p>To prevent this, you can specify that the items of the array property must be of a particular class. Each item will then be converted from JSON according to the property-type rules for that class, described in the previous section. To specify the type, implement a class method with a name of the form <em>propertyname</em>ItemClass, as in this example:</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>@interface Star : CBLModel
@property (copy) NSArray* observations;  // items are NSDates
@end
//
@implementation Star
@dynamic observationDates;
// Declares that the items of the observations property are NSDates.
+ (Class) observationsItemClass {
    return [NSDate class];
}
@end
</code></pre></span><span class="stripe-display swift"><pre><code>@objc(Star)
class Star: CBLModel {
    @NSManaged var observations: NSArray // items are NSDates
    class func observationsItemClass() -&gt; AnyClass {
        return NSDate.self
    }
}
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>

            <h3 id="raw">Raw access to document properties</h3><p>You don't <em>have</em> to create an Objective-C property for every document property. It's possible to access arbitrary document properties by name, by calling <code>-getValueOfProperty:</code> and <code>-setValue:ofProperty:</code>.</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>// Let's say Note documents have a JSON property "type" that we haven't
// defined a property for. We can access it like this:
NSString* noteType = [note getValueOfProperty: @"type"];
[note setValue: noteType ofProperty: @"type"];
</code></pre></span><span class="stripe-display swift"><pre><code>// Let's say Note documents have a JSON property "type" that we haven't
// defined a property for. We can access it like this:
let noteType = note.getValueOfProperty("type") as String
note.setValue(noteType, ofProperty: "type")
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>

            <h3 id="attachments">Attachments</h3><p>Model objects also support access to document <a href="../../../../../develop/guides/couchbase-lite/native-api/attachment/index.html">attachments</a>. The API is very similar to that of the UnsavedRevision class: you can access attachments using the <code>attachmentNames</code> property and <code>attachmentNamed</code> method, and modify attachments using <code>setAttachmentNamed</code> and <code>removeAttachmentNamed</code>. (Changes to attachments aren't saved to the database until the model object is <a href="../../../../../develop/guides/couchbase-lite/native-api/model/index.html#saving">saved</a>.)</p>
        <h2 id="instantiating">Instantiating model objects</h2><hr></hr>
                <p>Remember that every model object is associated one-to-one with a document in the database. When you instantiate a model, you either specify its document, or you can create a new document for it.</p>
                <p>To create a new model object on a new document:</p>
                <div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>Note* newNote = [[Note alloc] initWithNewDocumentInDatabase: self.database];
</code></pre></span><span class="stripe-display swift"><pre><code>let newNote = Note(newDocumentInDatabase: self.database)
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>
                <p>To instantiate the model for an existing document (or even a document that doesn't exist yet but which you want to have a specific ID):</p>
                <div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>CBLDocument* doc = self.database[@"some-note"];
Note* note = [Note modelForDocument: doc];
</code></pre></span><span class="stripe-display swift"><pre><code>let doc = self.database["some-note"]
let note = Note(forDocument: doc)
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>
                <p>The <code>+modelForDocument:</code> method is inherited from CBLModel; you don't need to override it. But it always creates an instance of the class that it's invoked on, <code>Note</code> in the example.</p>
                <div class="note"><span class="tag">Note:</span>There is never more than one model object for a particular document. If you call <code>+modelForDocument:</code> again on the same CBLDocument, it will return the same model object.</div>

                <h3 id="initializers">Custom initializer methods</h3><p>The designated initializer for CBLModel is <code>-initWithDocument:</code>. If your subclass needs to initialize state when it's created, it should override this method and call the superclass method. The parameter is a <code>CBLDocument*</code>, which will be <code>nil</code> if the model is being created with a new document.</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>- (instancetype) initWithDocument: (CBLDocument*)document {
    self = [super initWithDocument: document];
    if (self) {
        // Custom initialization of transient state:
        self.timeInstantiated = [NSDate date];
    }
    return self;
}
</code></pre></span><span class="stripe-display swift"><pre><code>override init!(document: CBLDocument!) {
    super.init(document: document)
    self.timeInstantiated = NSDate()
}
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>

                <h3 id="factory">Dynamic instantiation using the model factory</h3><p>There's one limitation of the default mechanism of instantiating model objects: you have to know what class the model object will be before you instantiate it, since you call <code>+modelForDocument:</code> on that specific class. This can be a problem if you have a hierarchy of model classes, and want to instantiate different subclasses for different types of documents.</p><p>For example, let's say you have a fancy to-do list that supports not just text notes but voice notes and picture notes. You've created <code>VoiceNote</code> and <code>PictureNote</code> subclasses of <code>Note</code> for these, and the documents in the database follow the convention of using a <code>"type"</code> property to identify their type, with values <code>"note"</code>, <code>"voice_note"</code> and <code>"picture_note"</code>. Now, any time you want to instantiate a model object, it seems you'll first have to look at the document's <code>"type"</code> property, match the value to a <code>Note</code> class, and instantiate that class:</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>// This is the CLUMSY and INEFFICIENT way to handle dynamic typing:
CBLDocument* doc = self.database[@"some-note"];
Note* note;
NSString* type = doc[@"type"];
if ([type isEqualToString: @"note"]) {
    note = [Note modelForDocument: doc];
} else if ([type isEqualToString: @"voice_note"]) {
    note = [VoiceNote modelForDocument: doc];
} else if ([type isEqualToString: @"picture_note"]) {
    note = [PictureNote modelForDocument: doc];
} else {
    note = nil;
}
</code></pre></span><span class="stripe-display swift"><pre><code>// This is the CLUMSY and INEFFICIENT way to handle dynamic typing:
let doc = self.database["some-note"]
var note: Note?
let type = doc["type"] as? String;
if type == "note" {
    note = Note(forDocument: doc)
} else if type == "voice_note" {
    note = VoiceNote(forDocument: doc)
} else if type == "picture_note" {
    note = PictureNote(forDocument: doc)
} else {
    note = nil
}
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span><p>Even worse, let's say you have a model class that has a reference to a Note, i.e. a property of type <code>Note*</code>. When resolving this property value, CBLModel will instantiate a <code>Note</code> object, even if the document's type indicates it should be represented by a <code>VoiceNote</code> or <code>PictureNote</code>!</p><p>To solve these problems, register your model classes with the database's ModelFactory, specifying a different <code>"type"</code> value for each one:</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>// Do this once per launch, probably right after opening the database:
CBLModelFactory* factory = self.database.modelFactory;
[factory registerClass: [Note class] forType: @"note"];
[factory registerClass: [VoiceNote class] forType: @"voice_note"];
[factory registerClass: [PictureNote class] forType: @"picture_note"];
</code></pre></span><span class="stripe-display swift"><pre><code>// Do this once per launch, probably right after opening the database:
let factory = self.database.modelFactory
factory.registerClass(Note.self, forDocumentType: "note")
factory.registerClass(VoiceNote.self, forDocumentType: "voice_note")
factory.registerClass(PictureNote.self, forDocumentType: "picture_note")
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span><p>Once you've done this, you can now call <code>+modelForDocument:</code> directly on CBLModel, instead of on your subclass; the method will look up the document's type in the model factory to find out what class to instantiate.</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>// This is the clean way to handle dynamic typing:
CBLDocument* doc = self.database[@"some-note"];
Note* note = (Note*)[CBLModel modelForDocument: doc];
</code></pre></span><span class="stripe-display swift"><pre><code>// This is the clean way to handle dynamic typing:
let doc = self.database["some-note"]
let note = CBLModel(forDocument: doc) as Note
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span><p>This doesn't look much different from the usual style; but by letting CBLModel choose the class, you'll dynamically get an object of the correct subclass (Note, VoiceNote or PictureNote) based on the <code>"type"</code> property of the individual document. Also, when resolving a property value whose type is a model class, the factory will be used to ensure that the correct subclass is instantiated.</p><div class="note"><span class="tag">Note:</span>For this to work, you do have to make sure your model object sets the document's <code>"type"</code> property appropriately!</div>

            <h2 id="saving">Saving model objects</h2><hr></hr>
                <p>Model objects can have mutable state: their properties can be declared <code>readwrite</code>, and their attachments can be modified. Such changes are made only in memory, and don't affect the underlying Document until the model object is saved.</p>
                <div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>// Toggle a note's checkbox property and save it:
note.checked = !note.checked;
NSError* error;
if (![note save: &amp;error])
    [self handleError: error];
</code></pre></span><span class="stripe-display swift"><pre><code>// Toggle a note's checkbox property and save it:
note.checked = !note.checked
var error: NSError?
if !note.save(&amp;error) {
    handleError(error)
}
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>
                <div class="note tip"><span class="tag">Tip:</span>You can efficiently save all changed models at once, by calling the database's <code>saveAllModels</code> method.</div>
                <p>If you don't want to deal with saving manually, you can set a model object's <code>autosaves</code> property. When this boolean property is set, the model will automatically call <code>save:</code> shortly after its state is changed. (The save occurs after the current thread returns back to the runloop, and only happens once even if multiple changes were made.)</p>
                <div class="note tip"><span class="tag">Tip:</span>You can increase the delay before the auto-save by overriding the <code>autosaveDelay</code> property, whose default value is 0, to a longer time interval.</div>
                <p>If instead you want to undo all changes and revert the model object back to the document's state, call <code>revertChanges</code>.</p>
                <p>To delete the document, call <code>deleteDocument:</code>. (Afterwards, don't use the model object anymore; with a deleted document it's no longer in a useable state.)</p>

                <h3 id="customizing-save">Customizing saving</h3><p>If you need to do something just before a model is saved, don't override <code>save</code> -- it isn't called in all cases where the model gets saved. Instead, override <code>willSave</code>. This is guaranteed to be called right before a save. It's passed a set of the names of all the modified properties, which could be useful. Your implementation can even change property values if it wants to, for instance to update a timestamp:</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>- (void) willSave: (NSSet*)changedPropertyNames {
    self.saveCount++;
    self.lastSavedTime = [NSDate date];
}
</code></pre></span><span class="stripe-display swift"><pre><code>override func willSave(changedPropertyNames: NSSet!) {
    saveCount++
    lastSaveTime = NSDate()
}
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span><p>You may need a specific type of customization when deleting a model's document: storing some information in the deleted document's "tombstone" revision, generally for the use of the server. To do this, override <code>propertiesToSaveForDeletion</code> and return an NSDictionary of properties. It's best to call the base implementation and modify the dictionary it returns:</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>- (NSDictionary*) propertiesToSaveForDeletion {
    NSMutableDictionary* props = [[super propertiesToSaveForDeletion] mutableCopy];
    props[@"timestamp"] = [CBLJSON JSONObjectWithDate: [NSDate date]];
    return props;
}
</code></pre></span><span class="stripe-display swift"><pre><code>override func propertiesToSaveForDeletion() -&gt; [NSObject : AnyObject]! {
    var props = super.propertiesToSaveForDeletion()
    props["timestamp"] = CBLJSON.JSONObjectWithDate(NSDate())
    return props
}
</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span><p>Sometimes you don't want to save immediately, but you want to get the model's current state as a JSON object, i.e. the data that <em>would</em> be saved to the document. The <code>propertiesToSave</code> method returns this.</p>

            </article><div class="page-footer"><span>Copyright © 2014 Couchbase Inc.  All rights reserved.</span><a href="http://www.couchbase.com/terms-of-service">Terms of Use</a><a href="http://www.couchbase.com/privacy">Privacy Policy</a></div></div></body></html>