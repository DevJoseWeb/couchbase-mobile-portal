<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html><head><title>Encrypting Couchbase Lite databases | Couchbase Mobile - Developers</title><link rel="stylesheet" type="text/css" href="../../../../../styles/style.css"></link><style class="language-stripe" id="language-stripe-objective-c" type="text/css">*.stripe-display.objective-c{display:inline;}*.stripe-active.objective-c{background:rgba(0, 0, 0, 0.05);}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-swift" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:inline;}*.stripe-active.swift{background:rgba(0, 0, 0, 0.05);}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-java" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:inline;}*.stripe-active.java{background:rgba(0, 0, 0, 0.05);}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-android" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:inline;}*.stripe-active.android{background:rgba(0, 0, 0, 0.05);}*.stripe-display.c{display:none;}*.stripe-active.c{background:transparent;}</style><style class="language-stripe" id="language-stripe-c" type="text/css">*.stripe-display.objective-c{display:none;}*.stripe-active.objective-c{background:transparent;}*.stripe-display.swift{display:none;}*.stripe-active.swift{background:transparent;}*.stripe-display.java{display:none;}*.stripe-active.java{background:transparent;}*.stripe-display.android{display:none;}*.stripe-active.android{background:transparent;}*.stripe-display.c{display:inline;}*.stripe-active.c{background:rgba(0, 0, 0, 0.05);}</style><script type="text/javascript">var languages = ["objective-c","swift","java","android","c"];
                    
	                var cookies = document.cookie.split(';');
				    for(var i=0; i<cookies.length; i++) {
				        var cookie = cookies[i].trim();
				        
				        if (cookie.indexOf("language=")==0) {
				            var selectedLanguage = cookie.substring(9, cookie.length);
				            if (selectedLanguage.length > 0) {
				                document.write("<style class='language-stripe' type='text/css'>");
				                for (var j=0; j<languages.length; j++) {
				                    var language = languages[j];
				                    document.write("*.stripe-display." + language + "{display:" + (language == selectedLanguage ? "inline" : "none") + ";}");
                                    document.write("*.stripe-active." + language + "{background:" + (language == selectedLanguage ? "rgba(0, 0, 0, 0.05)" : "transparent") + ";}");
				                }
				                document.write("</style>");
				            }
				            break;
				        }
				    }
				    
			    </script><script type="text/javascript">
                var rootPath = "../../../../../";</script><script src="../../../../../scripts/core.js"></script><script src="../../../../../scripts/search-core.js"></script><script src="../../../../../scripts/search.js"></script><script src="../../../../../scripts/search-index.js"></script><noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
        </noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-MVPNN2');
        </script><script type="text/javascript">
            document.write(unescape("%3Cscript src='//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
        </script><script>Munchkin.init('302-GJY-034');</script></head><body onload="init()"><div class="page-header"><table class="navigator-bar"><tr><td><a class="dark logo" href="../../../../../index.html"><div>Couchbase Mobile</div><div>Developers</div></a></td><td><a class="dark" href="../../../../../get-started/couchbase-mobile-overview/index.html">Get Started</a></td><td><a class="dark active" href="../../../../../develop/training/build-first-ios-app/index.html">Develop</a></td><td><a class="dark" href="https://forums.couchbase.com/mobile">Forums</a></td><td width="100%"></td><td><input class="search" type="text" onkeyup="search_onkeyup(this)" onchange="search_onchange(this)" onfocus="search_onfocus(this)" onblur="search_onblur(this)"></input></td></tr></table><div class="search-results-wrapper"><div class="search-results-floater"><div id="search-results" class="hidden"></div></div></div><div class="secondary-navigator-bar"><table class="items"><tr><td><a class="dark" href="../../../../../develop/training/build-first-ios-app/index.html">Training</a></td><td><a class="dark active" href="../../../../../develop/guides/modeling/index.html">Guides</a></td><td><a class="dark" href="../../../../../develop/references/couchbase-lite/index.html">API References</a></td><td><a class="dark" href="../../../../../develop/samples/samples/index.html">Samples</a></td><td><a class="dark" href="http://www.couchbase.com/nosql-databases/downloads#Couchbase_Mobile">Downloads</a></td><td width="100%"></td></tr></table></div></div><div class="header-spacer"></div><div class="page-wrapper"><nav><ul class="nav-list"><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/modeling/index.html">Data Modeling</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/modeling/basics/index.html">The Basics</a></li><li class="nav-item"><a href="../../../../../develop/guides/modeling/one-to-many/index.html">One-to-Many Relationships</a></li></ul></li><li class="nav-section expanded"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/couchbase-lite/index.html">Couchbase Lite</a></div><ul><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/couchbase-lite/native-api/index.html">Native API</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/manager/index.html">Manager</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/database/index.html">Database</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/document/index.html">Document</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/revision/index.html">Revision</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/attachment/index.html">Attachment</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/view/index.html">View</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/query/index.html">Query</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/replication/index.html">Replication</a></li><li class="nav-item"><a href="../../../../../develop/guides/couchbase-lite/native-api/model/index.html">Model (iOS only)</a></li></ul></li><li class="nav-subsection expanded"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/couchbase-lite/tech-notes/index.html">Technical Notes</a></div><ul><li class="nav-item active"><a href="../../../../../develop/guides/couchbase-lite/tech-notes/cbl-encryption/index.html">Encrypting Couchbase Lite databases</a></li></ul></li></ul></li><li class="nav-section"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/index.html">Sync Gateway</a></div><ul><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/index.html">Running the Sync Gateway</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/installing-sync-gateway/index.html">Installing Sync Gateway</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/connecting-sync-gateway-to-couchbase-server/index.html">Connecting Sync Gateway to Couchbase Server</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/starting-sync-gateway/index.html">Starting Sync Gateway</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/getting-started-with-sync-gateway/stopping-sync-gateway/index.html">Stopping Sync Gateway</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/index.html">Configuration and administration</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/command-line-tool/index.html">Configuration options</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/administering-the-rest-apis/index.html">Administering the REST APIs</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/authorizing-users/index.html">Authorizing Users</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/administering-sync-gateway/authenticating-users/index.html">Authenticating Users</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/channels/index.html">Data routing with "channels"</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/channels/intro/index.html">Introduction to channels</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/channels/developing/index.html">Developing channels</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/channels/troubleshooting/index.html">Troubleshooting channels</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/index.html">Sync Function API</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/intro/index.html">Introduction</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/validation/index.html">Validation and Authorization</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/sync-function-api-guide/routing/index.html">Routing</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/changes-worker/index.html">Connecting additional backend processes</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/changes-worker/pattern/index.html">Changes Worker Pattern</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/changes-worker/example-workflow/index.html">Example Document Workflow</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/changes-worker/push/index.html">Push Notification Code</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/deployment/index.html">Deployment considerations</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/deployment/during-development/index.html">During Development</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/deployment/in-production/index.html">In Production</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/deployment/troubleshooting/index.html">Troubleshooting and Fine-Tuning</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/nginx/index.html">Deploying Sync Gateway behind a reverse proxy</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/nginx/introduction-to-reverse-proxies/index.html">Introduction to reverse proxies</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/nginx/configuring-nginx-for-sync-gateway/index.html">Deploying and configuring nginx</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/accessing-cb-views/index.html">Accessing Couchbase Server views via Sync Gateway</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/accessing-cb-views/creating-and-using-a-view/index.html">Creating and querying a View</a></li></ul></li><li class="nav-subsection"><div onclick="toggleExpanded(this.parentNode)" class="header"><a href="../../../../../develop/guides/sync-gateway/os-level-tuning/index.html">OS Level Tuning</a></div><ul><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/os-level-tuning/max-file-descriptors/index.html">Tuning the max no. of file descriptors</a></li><li class="nav-item"><a href="../../../../../develop/guides/sync-gateway/os-level-tuning/tcp-keep-alive/index.html">Tuning the TCP Keepalive parameters</a></li></ul></li></ul></li></ul></nav><article class="content-wrapper"><h1>Encrypting Couchbase Lite databases</h1><div class="toc"><h2>In this document</h2><ul class="plain"><li><a href="#building-your-app">Building your app</a></li><li><a href="#enabling-encryption">Enabling encryption</a><ul><li><a href="#errors-opening-database">Errors when opening an encrypted database</a></li><li><a href="#cblencryptioncontroller">Class CBLEncryptionController</a></li></ul></li><li><a href="#passwords-and-keys">Passwords and keys</a><ul><li><a href="#where-to-store-key">Where to store the key</a></li><li><a href="#generating-good-keys">Generating good keys</a></li></ul></li><li><a href="#other-things">Other things to know</a><ul><li><a href="#encryption-and-replication">Database encryption and replication</a></li><li><a href="#no-attachment-access">No access to attachment files</a></li><li><a href="#opening-or-creating">Am I creating or opening a database?</a></li></ul></li></ul></div><div class="note"><span class="tag">Note:</span>(<strong>Status as of May 2015</strong>) This feature is available in Couchbase Lite 1.1. It is currently implemented solely for iOS and OS X.
            Versions for .NET and Java are under development. This feature currently supports only SQLite, not ForestDB.</div><p>
            Optionally you can encrypt an entire Couchbase Lite database. The algorithm used is AES-256, which is highly secure. The database is encrypted using
            <a href="https://www.zetetic.net/sqlcipher/">SQLCipher</a>, a fork of SQLite. Attachments are individually encrypted in the filesystem.
        </p><h3 id="why-to-use">Why to use encryption</h3><p>Examples of cases when you might want to encrypt a Couchbase Lite database are:</p><ul><li>If your iOS app needs to store private or confidential data, and you don't trust users to
                    enable passcodes on their iOS devices</li><li>If regulations such as HIPAA (Health Insurance Portability and Accountability Act) require
                        you to use encryption</li><li>If you develop for OS X and want to store data securely</li></ul><h3 id="why-to-not-use">Why to not use encryption</h3><p>Examples of cases when you might <em>not</em> want to encrypt a Couchbase Lite database are:</p><ul><li>When data stored in the database is not private or confidential, so there is no need to store the data
                    securely</li><li>If you consider the native filesystem encryption on the mobile devices to be good enough for <em>all</em> use cases.
                    Note that the native filesystem encryption might not be enabled by default, and that not all users will enable it. For example, on iOS,
                    in order to enable encryption, a user must set up a device passcode. If s/he has done so, then all app files are encrypted with a key that is unavailable
                    when the app is not running. On OS X, encryption is not enabled by default, though a user can opt into full-disk FileVault encryption.</li><li>Key management can annoy the user. On the latest iOS devices, you can use Touch ID, but on earlier devices you must prompt the user
                        for a passcode when your app starts because, if you don't trust the built-in device security, that means that you don't trust the keychain
                        to hold the key.</li><li>There is a slight drop in performance. SQLCipher claims about 5-15% overhead in database I/O.</li><li>Your app will be larger. You must embed a copy of SQLCipher in your application, instead of using the operating system's
                        built-in SQLite library.</li></ul><h2 id="building-your-app">Building your app</h2><hr></hr>
               <p>To build your app with an embedded copy of SQLCipher:</p>
                <ol><li>Download the appropriate SQLCipher static library from our <a href="https://github.com/couchbasedeps/sqlcipher/releases/">SQLCipher
                        release page</a>.</li><li>Add the SQLCipher library to your Xcode project.</li><li>Go to the <strong>Link Binary With Libraries</strong> build phase of your app target.</li><li>Remove <code>libsqlite.dylib</code>.</li><li>Add the SQLCipher library.</li><li>Build and run your app.</li></ol>
            <h2 id="enabling-encryption">Enabling encryption</h2><hr></hr>
                    <p>At this point, Couchbase Lite won't work any differently. Databases are still unencrypted by default.</p>
                    <p>Before creating or opening an encrypted database, you must register its password or key:</p>
                    <div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift disabled">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>CBLManager* mgr = [CBLManager sharedInstance];
[mgr registerEncryptionKey: @"password123456" forDatabaseNamed: @"launch-codes"];
CBLDatabase* db = [mgr databaseNamed: @"launch-codes" error: &amp;error];
</code></pre></span><span class="stripe-display swift"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span>
                    <p>The encryption key is applied when the database is created, that is, the first time <code>databaseNamed:</code> is called. After that,
                        the same key needs to be registered before the database can be re-opened. (It is not currently possible to add encryption to an existing
                        database, or to change or remove the key afterwards.)</p>
                   <h3 id="errors-opening-database">Errors when opening an encrypted database</h3><p>Following are encryption-related errors that you might encounter when attempting to open an encrypted database:</p><div class="table"><table><thead><tr><th>Domain</th><th>Code</th><th>Meaning</th></tr></thead><tbody><tr><td>
                                           <code>CBLHTTP</code>
                                       </td><td><code>401</code></td><td>The password is incorrect or no password was given when attempting to open an encrypted database.</td></tr><tr><td>
                                           <code>CBLHTTP</code>
                                       </td><td><code>501</code></td><td>Encryption is not supported (that is, the app was linked with SQLite instead of SQLCipher).</td></tr></tbody></table></div> 
                    <h3 id="cblencryptioncontroller">Class CBLEncryptionController</h3><p>We've created a utility class, CBLEncryptionController, to take care of the mundane details of password entry.
                                It prompts the user to make up a key, asks for the key when re-opening the database, and asks again if the key was
                                incorrect. It even takes advantage of Touch ID fingerprint authentication on recent iOS devices to avoid making the
                                user deal with a password at all. It's available in source form from the <code>Extras</code> folder in the Couchbase Lite
                                distribution, or from
                                <a href="https://github.com/couchbase/couchbase-lite-ios/blob/master/Source/API/Extras/CBLEncryptionController.h">
                                the Github repository</a>.
                            </p><p>Using <code>CBLEncryptionController</code>, opening a database looks like:</p><div class="tab-bar"><a href="javascript:setLanguage(&#34;objective-c&#34;)" class="tab stripe-active objective-c">Objective-C</a><a href="javascript:setLanguage(&#34;swift&#34;)" class="tab stripe-active swift disabled">Swift</a><a href="javascript:setLanguage(&#34;java&#34;)" class="tab stripe-active java disabled">Java</a><a href="javascript:setLanguage(&#34;android&#34;)" class="tab stripe-active android disabled">Android</a><a href="javascript:setLanguage(&#34;c&#34;)" class="tab stripe-active c disabled">C#</a></div><span class="stripe-display objective-c"><pre><code>CBLEncryptionController* enc = [[CBLEncryptionController alloc]
    initWithDatabaseName: @"launch-codes"];
enc.parentController = self.rootViewController;
[enc openDatabaseAsync: ^(CBLDatabase *db, NSError *error) {
    // now you can access the database
}];
</code></pre></span><span class="stripe-display swift"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display java"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display android"><pre><code class="disabled">No code example is currently available.</code></pre></span><span class="stripe-display c"><pre><code class="disabled">No code example is currently available.</code></pre></span><p>As you can see, the API is asynchronous; you supply a callback block that will be invoked later when the database
                                has been opened. This is necessary because opening the database is likely to require user intervention (entering a password,
                                pressing their thumb to the sensor). More details are available in the comments in the class's header file.
                            </p><p>The actual password-prompt UI is pretty minimal, just using <code>UIAlertController</code>. You will likely want to
                                replace that with something that fits better into your app's UX. You can do that by subclassing
                                <code>CBLEncryptionController</code>. Or if you want, you can write your own controller, using the source code of ours as a
                                reference.</p><h4 id="">Example</h4><p>To see a real app that uses <code>CBLEncryptionController</code>, get the 
                                    <a href="https://github.com/couchbaselabs/Grocery-Sync-iOS/tree/encryption">encryption branch of
                                        Grocery Sync</a>.</p> 
                <h2 id="passwords-and-keys">Passwords and keys</h2><hr></hr>
                <div class="note"><span class="tag">Note:</span>This entire section contains advanced material for those who are <em>not</em> using <code>CBLEncryptionController</code>.</div>
                <p>The database encryption key can be given either as an <code>NSString</code> object containing a password/passphrase, or as an <code>NSData</code>
                    object containing raw key data. The <code>NSData</code> object must be exactly 32 bytes long, that is, 256 bits. Any 32 bytes will work as a valid key.</p>
                <p>The actual encryption uses the AES algorithm, which uses 256-bit binary keys. Behind the scenes, a password string will be converted into binary
                    data using the <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2 algorithm</a>.</p>
                <h3 id="where-to-store-key">Where to store the key</h3><p>So where do you get this password or key from, that you register with the <code>CBLManager</code>? You have to store it someplace
                            persistent so that it can be used on the next launch of the app to decrypt the database. You have two choices, pretty much:</p><ul><li>Store it in the user's brain (or on a sticky note or something). That is, force the user to make up a password and memorize it, and then
                                to re-enter it on every launch of the app. If the user ever forgets the password, game over—the database is lost.</li><li>Store it in a Touch ID-protected keychain item, on a modern iOS device with a Touch ID (fingerprint) sensor. This is much better because the
                                user never has to remember anything or even see the key. Too bad not everyone has an iPhone 5s or later, though.</li></ul><p>Following are some places that you <em>cannot</em> store the password:</p><ul><li><strong>Hard-coded into your app</strong>: This is easy for an attacker to extract, and that breaks the security for
                                <em>every user</em> of your app.</li><li><strong>In a file</strong>: The whole reason that you're using encryption is because you don't trust the security of the device's filesystem.</li><li><strong>In an encrypted file</strong>: This begs the question of where you store the encryption key for that file. See above.</li><li><strong>In a regular keychain item</strong>: This is slightly more secure than in a file, but in practice an attacker who can get through the filesystem
                                encryption either has the device's passcode, or can make keychain calls pretending to be the app.</li></ul><p>Why is a Touch ID-protected Keychain item safe when a regular Keychain item isn't? Because it has an additional layer of encryption provided by the
                            secure enclave in the device's CPU, which will only decrypt the item when the user's fingerprint is present on the sensor. Hacking this requires either
                            creating a detailed fake replica of the user's fingerprint, or some nano-scale manipulation of the running CPU chip.</p><p><code>CBLEncryptionController</code> takes care of these details for you. We recommend that you use it.</p> 
                <h3 id="generating-good-keys">Generating good keys</h3><p>Following is information about generating good keys:</p><ul><li><strong>If using a user-entered password</strong>: The password needs to be hard to guess and hard to discover by brute-force methods.
                                The principles are well known, starting with obvious quality rules such as a minimum character length, a broad character set (not just letters!), and so forth.
                                Unfortunately, the stronger the password is, the less tolerable it is for the user to remember and to type it. Many apps give up entirely and just
                                let the user set a short numeric code, which is completely insecure.</li><li><strong>If generating a random binary key (for use with Touch ID, presumably)</strong>:
                                <ul><li><strong>Do</strong> call <code>SecRandomCopyBytes</code> as your source of data.</li><li><strong>Don't</strong> use a general-purpose random number generator, such as <code>random</code>, that is not random enough for cryptography.</li><li><strong>Don't</strong> try to convert a password string into a key yourself unless you know a lot about cryptography, understand what <code>PBKDF2</code>
                                        is and how it works, and think you can do better.</li></ul>
                            </li></ul> 
            <h2 id="other-things">Other things to know</h2><hr></hr>
                <p>Following are other things to know about encryption of Couchbase Lite databases.</p>
                <h3 id="encryption-and-replication">Database encryption and replication</h3><p><strong>Database encryption has nothing to do with replication</strong>: Encryption of a Couchbase Lite database only applies to data
                            <em>at rest</em> in the local database. The replicator still transfers documents in <em>unencrypted</em> form, so make
                            certain that you use SSL (that is, TLS) for all connections to the Sync Gateway server.</p><p>The Sync Gateway server will store <em>unencrypted</em> documents, so make certain that the server itself is secure
                            (which you are hopefully doing anyway).</p><p>End-to-end encryption of documents, such that documents are replicated in encrypted form and are not readable on the server, is possible,
                            but it is more complicated. We have done it experimentally, but we do not support this yet.</p> 
                <h3 id="no-attachment-access">No access to attachment files</h3><p>Generally you retrieve attachments as <code>NSData</code> objects, but Couchbase Lite does provide ways to get the path (or URL) of the
                            file that contains an attachment. If you're doing the latter, it won't work with an encrypted database, because the attachment files themselves
                            are encrypted and not directly readable. Instead, <code>CBLAttachment.contentURL</code> will be <code>nil</code>, and a <code>HEAD</code> call
                            to an attachment URL in the REST API will not include a <code>Location:</code> header that gives the full path of the file.</p><p>However, we've added a new way to read large attachments efficiently. The method <code>-[CBLAttachment openContentStream]</code>
                            returns an <code>NSInputStream</code> object through which you can read the decrypted contents of the attachment. Just make sure to close the
                            stream when you're done.</p>
                <h3 id="opening-or-creating">Am I creating or opening a database?</h3><p>It can be useful to know whether a database exists without opening it. For example, before creating a database you will want to ask the
                            user to pick a password for it. The new method <code>-[CBLManager databaseExistsNamed:]</code> just tells you whether a database exists.</p> 
            </article></div><div class="page-footer"><span>Copyright © 2015 Couchbase Inc.  All rights reserved.</span><a href="http://www.couchbase.com/terms-of-service">Terms of Use</a><a href="http://www.couchbase.com/privacy">Privacy Policy</a></div></body></html>